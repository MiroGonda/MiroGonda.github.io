<!DOCTYPE html>
<html>
<head>
  <title>Design Approval Gallery</title>
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
  <style>
    .swiper-container { width: 100%; height: 80vh; }
    .swiper-slide { text-align: center; display: flex; flex-direction: column; }
    img { max-width: 100%; max-height: 70vh; margin: 0 auto; }
    .buttons { margin-top: 20px; }
    .approve { background-color: red; color: white; padding: 10px; border: none; cursor: pointer; }
    .revise { background-color: blue; color: white; padding: 10px; border: none; cursor: pointer; }
    .revision-input { display: none; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="swiper-container">
    <div class="swiper-wrapper"></div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>
  <div class="buttons">
    <button class="approve" onclick="handleApprove()">Approve</button>
    <button class="revise" onclick="showRevisionInput()">Revise</button>
    <div class="revision-input">
      <textarea id="revisionText" placeholder="Enter revisions..."></textarea>
      <button onclick="handleRevise()">Submit Revision</button>
    </div>
  </div>

  <!-- Add Swiper JS -->
  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/YOUR_SHEET_ID/pub?output=csv";
    const SCRIPT_URL = "YOUR_GOOGLE_APPS_SCRIPT_URL"; // Replace with your Web App URL
    let currentRow = 1; // Tracks the current row in the carousel

    fetch(SHEET_URL)
      .then(response => response.text())
      .then(data => {
        const rows = data.split('\n').slice(1); // Skip header
        const swiperWrapper = document.querySelector('.swiper-wrapper');

        rows.forEach((row, index) => {
          const [name, figmaLink, pngUrl] = row.split(',');
          const slide = `
            <div class="swiper-slide">
              <h3>${name}</h3>
              <a href="${figmaLink}" target="_blank">
                <img src="${pngUrl}" alt="${name}" />
              </a>
            </div>
          `;
          swiperWrapper.insertAdjacentHTML('beforeend', slide);
        });

        // Initialize Swiper
        const swiper = new Swiper('.swiper-container', {
          pagination: { el: '.swiper-pagination', clickable: true },
          navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
          loop: false,
          keyboard: true,
          on: {
            slideChange: () => {
              currentRow = swiper.activeIndex + 1; // Update current row
            }
          }
        });
      });

    function handleApprove() {
      updateStatus("Approved");
    }

    function showRevisionInput() {
      document.querySelector('.revision-input').style.display = 'block';
    }

    function handleRevise() {
      const revisionText = document.getElementById('revisionText').value;
      if (revisionText) {
        updateStatus(`Revise: ${revisionText}`);
        document.querySelector('.revision-input').style.display = 'none';
        document.getElementById('revisionText').value = ''; // Clear input
      }
    }

    function updateStatus(status) {
      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify({ row: currentRow, status }),
        headers: { 'Content-Type': 'application/json' }
      })
        .then(response => response.text())
        .then(() => alert("Status updated successfully!"))
        .catch(() => alert("Failed to update status."));
    }
  </script>
</body>
</html>
